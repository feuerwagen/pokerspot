<div id="messages"></div>
<form action="form/message/{$action}/{$id}.html" method="post" class="cmxform">
	<fieldset>
		<legend>Empf√§nger</legend>
		<ul>
			<li>
				<select name="user[]" size="3" multiple="multiple"{if $id !== false}disabled="disabled"{/if}>
				{foreach from=$user item=u}
					<option value="{$u->username}"{if is_object($message->receiver) && $id === $message->receiver->username} selected="selected"{/if}>{$u->realname}</option>
				{/foreach}
				</select>
			</li>
		</ul>
	</fieldset>
	<fieldset>
		<legend>Nachricht</legend>
		<ul>
			<li><label for="subject">Betreff</label> <input type="Text" name="subject" value="{$message->subject}" /></li>
			<li><label for="text">Text</label> <textarea name="text" id="editor">{$message->text}</textarea></li>
		</ul>
	</fieldset>
</form>
{literal}
<script type="text/javascript">
$(document).ready(function() {
	$('#editor').tinymce({
		// Location of TinyMCE script
		script_url : $('base').attr('href')+'script/tinymce/tiny_mce_gzip.php',

		// General options
		theme : "advanced",
		skin : 'wp_theme',
		plugins : "safari,inlinepopups,paste",
		content_css : "/style/tinymce.css",

		// Theme options
		theme_advanced_buttons1 : "cut,copy,pastetext,|,bold,italic,strikethrough,|,bullist,numlist,|,link,unlink",
		theme_advanced_buttons2 : "",
		theme_advanced_buttons3 : "",
		theme_advanced_toolbar_location : "top",
		theme_advanced_toolbar_align : "left",
		theme_advanced_resizing : true,
		theme_advanced_resize_horizontal : false,

		paste_use_dialog : false,
		apply_source_formatting : true,
		forced_root_block : 'p',
		force_br_newlines : false,
		force_p_newlines : true,
		invalid_elements: 'span',	
		relative_urls : true,
		width : "100%"		
	});
	
	$('#dialog').find('form').bind('form-pre-serialize', function(e) {
	    tinyMCE.triggerSave();
	});
});
</script>
{/literal}